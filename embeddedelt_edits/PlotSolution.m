close all; 

x0 = [1,1,1,1,0,0,0,0,1,1,0,0,0.50,0.50,0,0,0.50,0,0,0.50,1,1,1,1;0.50,0.50,1,1,0.50,1,1,0.50,0,0,0,0,0,0,0,0,1,1,1,1,1,0,0,1;1,0,0,1,0,0,1,1,1,0,1,0,0.40,0.60,0.60,0.40,0.60,0.60,0.40,0.40,0.60,0.60,0.40,0.40];
x =  [1,1,0.978891399046114,0.978949565630780,0,0,0,0,1,1,0,0,0.500000000000000,0.500000000000000,0,0,0.489463149498457,0,0,0.489457332839990,0.978926298996913,1.00000000000000,1.00000000000000,0.978914665679980;0.500000000000000,0.500000000000000,1.03999064998311,1.03999064998311,0.500000000000000,1.03999064998311,1.03999064998311,0.500000000000000,0,0,0,0,0,0,0,0,1.03999064998311,1.03999064998311,1.03999064998311,1.03999064998311,1.03999064998311,0,0,1.03999064998311;1,0,0,0.978949565630782,0,0,0.978891399046117,1,1,0,1,0,0.400000000000000,0.600000000000000,0.600000000000000,0.400000000000000,0.587352289403070,0.587334839427670,0.391556559618447,0.391568192935380,0.587369739378469,0.600000000000000,0.400000000000000,0.391579826252313];
x0=GEOM.x0;
x=GEOM.x0;

connect = [8,5,20,17;5,8,17,14;6,11,18,13;7,12,19,20;1,2,13,21;2,1,14,22;3,9,15,23;4,10,16,24];
connect = FEM.mesh.connectivity;
nelt = size(connect,2);

% graphsize=[100 100 800 400];
figure();
hold on; grid on; view(3);
fig=gcf; fig.Position=graphsize;


%Orignial Shape    
for ii=1:nelt
        con = connect(:,ii);
        nx = x0(:,con);
        
        faces = zeros(3,4,6);
        faces(:,:,1) = [nx(:,4) nx(:,3) nx(:,2) nx(:,1)];
        faces(:,:,2) = [nx(:,1) nx(:,2) nx(:,6) nx(:,5)];
        faces(:,:,3) = [nx(:,2) nx(:,3) nx(:,7) nx(:,6)];
        faces(:,:,4) = [nx(:,3) nx(:,4) nx(:,8) nx(:,7)];
        faces(:,:,5) = [nx(:,1) nx(:,5) nx(:,8) nx(:,4)];
        faces(:,:,6) = [nx(:,5) nx(:,6) nx(:,7) nx(:,8)];

        plot3(nx(1,:),nx(2,:),nx(3,:),'ko');

    for i=1:6
        plot3([faces(1,:,i) faces(1,1,i)],[faces(2,:,i) faces(2,1,i)],[faces(3,:,i) faces(3,1,i)],'k-');
    end
   
end

%Deformed Shape
scalef = 1;
u = x-x0;
u = u*scalef; u(1,:)=u(1,:)*1; u(3,:)=u(3,:)*1;
xx = x0 + u;
for ii=1:nelt
        con = connect(:,ii);
        nx = xx(:,con);
        
        faces = zeros(3,4,6);
        faces(:,:,1) = [nx(:,4) nx(:,3) nx(:,2) nx(:,1)];
        faces(:,:,2) = [nx(:,1) nx(:,2) nx(:,6) nx(:,5)];
        faces(:,:,3) = [nx(:,2) nx(:,3) nx(:,7) nx(:,6)];
        faces(:,:,4) = [nx(:,3) nx(:,4) nx(:,8) nx(:,7)];
        faces(:,:,5) = [nx(:,1) nx(:,5) nx(:,8) nx(:,4)];
        faces(:,:,6) = [nx(:,5) nx(:,6) nx(:,7) nx(:,8)];

        plot3(nx(1,:),nx(2,:),nx(3,:),'ro');

    for i=1:6
        plot3([faces(1,:,i) faces(1,1,i)],[faces(2,:,i) faces(2,1,i)],[faces(3,:,i) faces(3,1,i)],'r-');
    end
   
end
